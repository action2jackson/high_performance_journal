{% extends 'journal/base.html' %}

{% load fullcalendar_tags %}

{% block title %}Daily Journal{% endblock %}

{% block content %}

    <script>

        $(document).ready(function () {
            var calendar = $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                events: [
                    {% for event in events %}
                        {
                            title: "{{ event.name }}",
                            start: '{{ event.start|date:"Y-m-d H:i:s" }}',
                            end: '{{ event.end|date:"Y-m-d H:i:s" }}',
                            id: '{{ event.id }}',
                        },
                    {% endfor %} 
                ],
                selectable: true,
                selectHelper: true,
                editable: true,
                eventLimit: true,
                defaultView: 'agendaWeek',
                allDayDefault: false,
                allDaySlot: false,
                slotMinutes: 15,
                nextDayThreshold: '00:00:00',
                defaultEventMinutes: 0, 
                select: function (start, end, allDay) {
                    var title = prompt("Enter Event Title");
                    if (title) {
                        var start = $.fullCalendar.formatDate(start, 'yyyy-MM-dd HH:mm:ss');
                        var end = $.fullCalendar.formatDate(end, 'yyyy-MM-dd HH:mm:ss');
                        $.ajax({
                            type: "GET",
                            url: '/add_event',
                            data: {'title': title, 'start': start, 'end': end},
                            dataType: "json",
                            success: function (data) {
                                $('#calendar').fullCalendar('addEventSource', data);
                                alert("Added Successfully");
                            },
                            failure: function (data) {
                                alert('There is a problem!!!');
                            }
                        });
                    }
                },
                eventResize: function (event) {
                    var start = $.fullCalendar.formatDate(event.start, 'yyyy-MM-dd HH:mm:ss');
                    var end = $.fullCalendar.formatDate(event.end, 'yyyy-MM-dd HH:mm:ss');
                    var title = event.title;
                    var id = event.id;
                    $.ajax({
                        type: "GET",
                        url: '/update',
                        data: {'title': title, 'start': start, 'end': end, 'id': id},
                        dataType: "json",
                        success: function (data) {
                            $('#calendar').fullCalendar('addEventSource', data);
                        },
                        failure: function (data) {
                            alert('There is a problem!!!');
                        }
                    });
                },

                eventDrop: function (event) {
                    var start = $.fullCalendar.formatDate(event.start, 'yyyy-MM-dd HH:mm:ss');
                    var end = $.fullCalendar.formatDate(event.end, 'yyyy-MM-dd HH:mm:ss');
                    var title = event.title;
                    var id = event.id;
                    $.ajax({
                        type: "GET",
                        url: '/update',
                        data: {'title': title, 'start': start, 'end': end, 'id': id},
                        dataType: "json",
                        success: function (data) {
                            $('#calendar').fullCalendar('addEventSource', data);
                        },
                        failure: function (data) {
                            alert('There is a problem!!!');
                        }
                    });
                },

                eventClick: function (event) {
                    if (confirm("Are you sure you want to remove it?")) {
                        var id = event.id;
                        $.ajax({
                            type: "GET",
                            url: '/remove',
                            data: {'id': id},
                            dataType: "json",
                            success: function (data) {
                                $('#calendar').fullCalendar('addEventSource', data);
                                alert('Event Removed');
                            },
                            failure: function (data) {
                                alert('There is a problem!!!');
                            }
                        });
                    }
                },

            });
        });

    </script>
    <div class="main_journal_container">
        {% fullcalendar_css %}        
        {% fullcalendar_print_css %}        
        {% fullcalendar_jquery %}
        {% fullcalendar_jquery_ui %}
        {% fullcalendar_javascript %}

        
        <div class="container">
            <div id="calendar" style="background-color: white">
                {% for eventy in all_events %}
                    {{ eventy }}
                {% endfor %}                
            </div>
        </div>
    </div>


    <!-- <div class="daily_journal_header">
        Date + Day of the week + Day of 90 day sprint 
    </div> -->
        <!-- <div class="daily_journal_container">
            <div class="journal_container">
                <h1>Daily Schedule</h1>
            </div>
            <div class="journal_spacing">
                <span></span>
            </div>
            <div class="task_container">
                <h1>To Do</h1>
                <form method="POST" action="{% url 'daily_journal' %}">
                    {% csrf_token %}
                    <p>{{ taskForm.title }}</p>
                    <input style="display: none" type="submit" value="Enter">
                </form>
                {% for task in tasks %}
                    <div class="todo_list">
                        Add JS to make delete fade nice
                        <a href="{% url 'task_delete' pk=task.pk %}">
                            <p class="far fa-square"></p>
                            <p class="far fa-check-square"></p>
                        </a>
                        {{ task }}
                    </div>
                {% endfor %}
            </div>
        </div> -->

{% endblock %}